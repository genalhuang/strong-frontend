# tcp

### TCP的可靠数据管道
### TCP流是分段的、由IP分组传送 
![](./assets/1.png)

### TCP 连接建立握手； 
### 流量控制； 
流量控制是一种预防发送端过多向接收端发送数据的机制。否则，接收端可能因为
忙碌、负载重或缓冲区既定而无法处理。为实现流量控制，TCP 连接的每一方都要
通告（图 2-2）自己的接收窗口（rwnd），其中包含能够保存数据的缓冲区空间大小
信息。
rwnd: 流量控制窗口，设定发送端到接收端窗口的最大值。
### TCP 慢启动； 
发送端和接收端在连接建立之初，谁也不知
道可用带宽是多少，因此需要一个估算机制，然后还要根据网络中不断变化的条件
而动态改变速度。

cwnd: 拥塞控制窗口， 发送端从客户端接收确认ACK之前可以发送数据量的限制

慢启动，即在分组被确认后增大窗口大小，慢慢地启动！

把服务器的初始 cwnd 值增大到 RFC 6928 新规定的 10 段（IW10），是提升用户体
验以及所有 TCP 应用性能的最简单方式。

### 拥挤预防
慢启动以保守的窗口初始化连接，随后的
每次往返都会成倍提高传输的数据量，直到超过接收端的流量控制窗口，即系统
配置的拥塞阈值（ssthresh）窗口，或者有分组丢失为止，此时拥塞预防算法介入

拥塞预防算法把丢包作为网络拥塞的标志，即路径中某个连接或路由器已经拥堵了，
以至于必须采取删包措施。因此，必须调整窗口大小，以避免造成更多的包丢失，
从而保证网络畅通
PRR（Proportional Rate Reduction，比例降速）就是 RFC 6937 规定的一个新算法，
其目标就是改进丢包后的恢复速度。


发送端和接收端之间在途未确认的最大数据量，取决于拥塞窗
口（cwnd）和接收窗口（rwnd）的最小值。接收窗口会随每次 ACK 一起发送，而
拥塞窗口则由发送端根据拥塞控制和预防算法动态调整


### 带宽延迟积
BDP（Bandwidth-delay product，带宽延迟积）
数据链路的容量与其端到端延迟的乘积。这个结果就是任意时刻处于在途未确认
状态的最大数据量。
### 数据聚集的 Nagle 算法； 
### 用于捎带确认的 TCP 延迟确认算法； 
### TIME_WAIT 时延和端口耗尽。