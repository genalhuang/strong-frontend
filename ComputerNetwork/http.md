# http 超文本传输协议

### http1.0

### http1.1
• 持久化连接以支持连接重用；
• 分块传输编码以支持流式响应；
• 请求管道以支持并行请求处理；
• 字节服务以支持基于范围的资源请求；　
• 改进的更好的缓存机制。

特点：
### 并行连接
HTTP 允许客户端打开多条连接，并行地执行多个 HTTP 事务。在  这个例子中，并行加载了四幅嵌入式图片，每个事务都有自己的 TCP 连接。
- 打开大量连接会消耗很多内存资源，从而引发自身的性能问题。复杂的 Web 页面可能会有数十或数百个内嵌对象。客户端可能可以打开数百个连接，但 Web 服 务器通常要同时处理很多其他用户的请求，所以很少有 Web 服务器希望出现这样的 情况。一百个用户同时发出申请，每个用户打开 100 个连接，服务器就要负责处理 10 000 个连接。这会造成服务器性能的严重下降。
![](./assets/3.png)
### 持久连接
在事务处理结束之后仍然保持在打开状态的 TCP 连接被称为持久连接。
![](./assets/2.png)
### 管道化连接
持久 HTTP 可以让我们重用已有的连接来完成多次应用请求，但多次请求必须严格
满足先进先出（FIFO）的队列顺序：发送请求，等待响应完成，再发送客户端队列
中的下一个请求。HTTP 管道是一个很小但对上述工作流却非常重要的一次优化。
管道可以让我们把 FIFO 队列从客户端（请求队列）迁移到服务器


存在问题： 
### 队首阻塞
由于 TCP 要求严格按照顺序交付，丢失一个 TCP 分组就会阻塞所有高序号的分组，除非重传那个丢失的分组，这样就会导致额外的应用延迟


### http2.0
HTTP 2.0 的目的就是通过支持请求与响应的多路复用来减少延迟，通过压缩 HTTP
首部字段将协议开销降至最低，同时增加对请求优先级和服务器端推送的支持。

HTTP/1.1中所有的请求与响应均以普通文本格式(plain text format)来传输的；

HTTP/2使用二进制分帧层将http message封装为二进制格式(binary format)，同时保持所使用的HTTP语义不变


### 二进制分帧层
• 流
已建立的连接上的双向字节流。流是连接中的一个虚拟信道，可以承载双向的消息（请求消息、响应消息）；每个流都有一个唯一的整数标识符（1、2…N）
• 消息
与逻辑消息对应的完整的一系列数据帧。消息是指逻辑上的 HTTP 消息，比如请求、响应等，由一或多个帧组成。
• 帧
HTTP 2.0 通信的最小单位，每个帧包含帧首部，至少也会标识出当前帧所属的流。

每个数据流以消息的形式发送，而消息由一或多个帧组成，这些帧可
以乱序发送，然后再根据每个帧首部的流标识符重新组装。

HTTP 2.0 的所有帧都采用二进制编码，所有首部数据都会被压缩。

把 HTTP 消息分解为独立的帧，交错发送，然后在另一端重新组装是 HTTP 2.0 最
重要的一项增强。

### 二进制分帧层优点
• 可以并行交错地发送请求，请求之间互不影响；
• 可以并行交错地发送响应，响应之间互不干扰；
• 只使用一个连接即可并行发送多个请求和响应；
• 消除不必要的延迟，从而减少页面加载的时间；
• 不必再为绕过 HTTP 1.x 限制而多做很多工作；

### 请求优先级
每个流都可以带有一个 31 比特的优先值：
• 0 表示最高优先级；
• 231-1 表示最低优先级。

有了这个优先值，客户端和服务器就可以在处理不同的流时采取不同的策略，以最
优的方式发送流、消息和帧。具体来讲，服务器可以根据流的优先级，控制资源分
配（CPU、内存、带宽），而在响应数据准备好之后，优先将最高优先级的帧发送给
客户端。